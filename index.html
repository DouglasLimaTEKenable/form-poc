<!DOCTYPE html>
<html lang="en" data-scroll-behavior="smooth">

<head>
    <meta charSet="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/form.css" />
    <title>Power Pages Form Embed POC</title>
    <style>
        .form-embed-container {
            width: 100%;
            position: relative;
            /* Set a minimum height to contain the spinner */
            min-height: 400px; 
        }

        .form-embed-container iframe {
            width: 100%;
            border: 0;
            /* --- CSS Change 1: Hide iframe initially and add transition --- */
            opacity: 0;
            transition: opacity 0.3s ease-in-out, height 0.2s ease-in-out;
        }

        /* --- CSS Change 2: Add styles for the loader --- */
        .loader {
            position: absolute;
            top: 50px; /* Position it a bit down from the top */
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid #f3f3f3; /* Light grey */
            border-top: 6px solid #2F4660; /* Using your site's dark blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.5s linear infinite;
            z-index: 10;
        }

        @keyframes spin {
            0% {
                transform: translateX(-50%) rotate(0deg);
            }
            100% {
                transform: translateX(-50%) rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <a href="#mainContent" class="skip-content">Skip to Content</a>
    <header class="megamenu-header">
        </header>
    <main class="" data-sfcontainer="main" id="mainContent">
        <section class="bg-light" data-sfcontainer="true">
            </section>
        <section class="" data-sfcontainer="true">
            <div class="container " data-sfcontainer="true">
                <div class="col-md-9 standard-content" data-sfcontainer="col-sm-9">

                    <div class="form-embed-container">
                        <div id="iframeLoader" class="loader"></div>
                        
                        <iframe 
                            id="formIframe"
                            src="https://poc-form.powerappsportals.com/Temp" 
                            title="Embedded Power Pages Form" 
                            width="100%"
                            height="800px" 
                            frameborder="0">
                        </iframe>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="footer">
        <script>
            document.getElementById("year").innerHTML = new Date().getFullYear();

            window.addEventListener("message", function (event) {
                // Only accept messages from your Power Pages domain
                if (event.origin !== "https://poc-form.powerappsportals.com") return;

                if (event.data && event.data.type === "resize-iframe") {
                    const iframe = document.querySelector('iframe[title="Embedded Power Pages Form"]');
                    if (iframe) iframe.style.height = event.data.height + "px";
                }
            });

            /* --- JavaScript Change: Add logic to show/hide loader --- */
            const iframe = document.getElementById('formIframe');
            const loader = document.getElementById('iframeLoader');

            // This function runs when the iframe content has finished loading
            iframe.onload = function () {
                loader.style.display = 'none'; // Hide the spinner
                iframe.style.opacity = '1';    // Fade in the iframe
            };
        </script>
    </footer>
</body>

</html>
